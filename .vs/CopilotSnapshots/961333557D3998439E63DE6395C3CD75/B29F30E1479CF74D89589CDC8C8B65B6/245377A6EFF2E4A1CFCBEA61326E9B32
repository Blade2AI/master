# PrecisePointway Consolidation Script
# Inventories files, copies to NAS, and generates a manifest
param(
    [string[]]$SourceRoots = @("C:\PrecisePointway", "D:\PrecisePointway", "E:\PrecisePointway", "F:\PrecisePointway"),
    [string]$TargetRoot = "Z:\PrecisePointway\master",
    [string]$ManifestPath = "Z:\PrecisePointway\master\manifest.csv"
)

$manifest = @()
foreach ($srcRoot in $SourceRoots) {
    if (Test-Path $srcRoot) {
        Get-ChildItem -Path $srcRoot -Recurse -File | ForEach-Object {
            $srcFile = $_.FullName
            $relPath = $srcFile.Substring($srcRoot.Length).TrimStart('\')
            $destFile = Join-Path $TargetRoot $relPath
            $destDir = Split-Path $destFile -Parent
            if (!(Test-Path $destDir)) { New-Item -ItemType Directory -Force -Path $destDir | Out-Null }
            Copy-Item -Path $srcFile -Destination $destFile -Force
            $manifest += [PSCustomObject]@{
                Source = $srcFile
                Destination = $destFile
                Size = $_.Length
                LastWriteTime = $_.LastWriteTime
            }
        }
    }
}

# Write manifest
$manifest | Export-Csv -Path $ManifestPath -NoTypeInformation -Encoding UTF8
Write-Host "PASS: Consolidation complete. Manifest at $ManifestPath"
